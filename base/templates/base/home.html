{% extends 'base/main.html' %}

{% block content %}

<main>
    <!-- Offcanvas for Popular Items -->
    <h3 class="popular-items-header">Popular Items</h3>
    <div class="popular-items-section">
        <div class="container">
            <!-- <h3>Popular Items</h3> -->
            <div class="popular-items-container">
                {% for card in card_items %}
                {% for item in card.items.all %}
                {% if item.popularity == 5 %}
                <div class="popular-item">
                    
                    <a href="{% url 'item-detail' item.id %}">
                        <img src="{{ item.image.url }}" alt="{{ item.title }}">
     

                        <!-- <div class="item-details">
                            <p class="item-title">{{ item.title }}</p>
                            <p class="item-price">${{ item.price }}</p>
                        </div> -->
                    </a>
                </div>
                {% endif %}
                {% endfor %}
                {% endfor %}
            </div>
        </div>
    </div>
    <!-- End of offcanvas -->

    <div class="card-container">
        {% for card in card_items %}
        <div class="card">
           
                <div id="carousel{{ card.id }}" class="carousel carousel-light slide data-bs-ride="carousel">                      
                <div class="carousel-inner">
                    {% for item in card.items.all %}
                    <div class="carousel-item{% if forloop.first %} active{% endif %}">
                        <a href="{% url 'item-detail' item.id %}">
                            <img src="{{ item.image.url }}" alt="{{ item.title }}">
                        </a>                   
                        <div class="card-item-details">
                            <p class="item-title">{{ item.title }}</p>
                            <p class="item-price">${{ item.price }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
               <p class="user-name">{{ card.user.name }}</p>
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ card.id }}" data-bs-slide="prev">
                    <span aria-hidden="true">&lt;</span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ card.id }}"data-bs-slide="next">
                    <span aria-hidden="true">&gt;</span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        
        {% endfor %}
    </div>


    <script>

        document.addEventListener("DOMContentLoaded", function() {
            const carousels = document.querySelectorAll('.carousel');
    
            carousels.forEach(carousel => {
                carousel.addEventListener('slid.bs.carousel', function() {
                    const carouselInner = this.querySelector('.carousel-inner');
                    const prevButton = this.querySelector('.carousel-control-prev');
                    const nextButton = this.querySelector('.carousel-control-next');
                    const activeItem = carouselInner.querySelector('.carousel-item.active');
    
                    // Hide both buttons by default
                    prevButton.style.display = 'none';
                    nextButton.style.display = 'none';
    
                    // Check if there's more than one item in the carousel
                    if (carouselInner.children.length > 1) {
                        // Show both buttons
                        prevButton.style.display = 'block';
                        nextButton.style.display = 'block';
    
                        // Check if the current slide is the first or last item
                        if (activeItem.nextElementSibling === null) {
                            nextButton.style.visibility = 'hidden';
                        } else {
                            nextButton.style.visibility = 'visible';
                        }
    
                        if (activeItem.previousElementSibling === null) {
                            prevButton.style.visibility = 'hidden';
                        } else {
                            prevButton.style.visibility = 'visible';
                        }
                    }
                });
            });
        });



    // OFFCANVASS ANIMATION   

    document.addEventListener("DOMContentLoaded", function() {
        var scrollContent = document.querySelector(".scroll-content");
        var items = scrollContent.innerHTML;
        scrollContent.innerHTML += items; // Duplicate the items

        // Adjust the duration of the animation based on the number of items
        var itemWidth = document.querySelector(".popular-item").offsetWidth;
        var itemCount = document.querySelectorAll(".popular-item").length;
        var totalWidth = itemWidth * itemCount;
        var scrollDuration = totalWidth / 50; // I'm leaving the speed at this, for the moment.

        // Update the animation duration
        document.styleSheets[0].insertRule(`@keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-${totalWidth / 2}px); } }`, 0);
        scrollContent.style.animationDuration = `${scrollDuration}s`;

    });

    </script> 
    
</main>
  
{% endblock %}
     

